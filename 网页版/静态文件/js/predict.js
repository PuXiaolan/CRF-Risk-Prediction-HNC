// å¤´é¢ˆç™ŒCRFé£é™©é¢„æµ‹å™¨ - åŸºäºSGDæœºå™¨å­¦ä¹ æ¨¡å‹
class CRFé¢„æµ‹å™¨ {
    constructor() {
        this.æ¨¡å‹å‚æ•° = null;
        this.åŠ è½½æ¨¡å‹();
    }

    async åŠ è½½æ¨¡å‹() {
        try {
            const å“åº” = await fetch('é™æ€æ–‡ä»¶/model_params.json');
            this.æ¨¡å‹å‚æ•° = await å“åº”.json();
            console.log('ğŸ¯ æ¨¡å‹åŠ è½½æˆåŠŸ');
        } catch (é”™è¯¯) {
            console.error('âŒ æ¨¡å‹åŠ è½½å¤±è´¥:', é”™è¯¯);
            alert('æ¨¡å‹åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        }
    }

    é¢„æµ‹(ç‰¹å¾æ•°ç»„) {
        if (!this.æ¨¡å‹å‚æ•°) {
            throw new Error('æ¨¡å‹æœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åé‡è¯•');
        }

        // ç‰¹å¾æ ‡å‡†åŒ–
        const æ ‡å‡†åŒ–ç‰¹å¾ = this.æ ‡å‡†åŒ–ç‰¹å¾(ç‰¹å¾æ•°ç»„);
        
        // çº¿æ€§ç»„åˆè®¡ç®—
        let çº¿æ€§è¾“å‡º = this.æ¨¡å‹å‚æ•°.æˆªè·;
        for (let i = 0; i < this.æ¨¡å‹å‚æ•°.ç³»æ•°.length; i++) {
            çº¿æ€§è¾“å‡º += this.æ¨¡å‹å‚æ•°.ç³»æ•°[i] * æ ‡å‡†åŒ–ç‰¹å¾[i];
        }
        
        // ä½¿ç”¨Sigmoidå‡½æ•°è®¡ç®—æ¦‚ç‡
        const æ¦‚ç‡ = 1 / (1 + Math.exp(-çº¿æ€§è¾“å‡º));
        
        return æ¦‚ç‡;
    }

    æ ‡å‡†åŒ–ç‰¹å¾(ç‰¹å¾æ•°ç»„) {
        const æ ‡å‡†åŒ–ç»“æœ = [];
        for (let i = 0; i < ç‰¹å¾æ•°ç»„.length; i++) {
            const æ ‡å‡†åŒ–å€¼ = (ç‰¹å¾æ•°ç»„[i] - this.æ¨¡å‹å‚æ•°.æ ‡å‡†åŒ–å‡å€¼[i]) / this.æ¨¡å‹å‚æ•°.æ ‡å‡†åŒ–æ ‡å‡†å·®[i];
            æ ‡å‡†åŒ–ç»“æœ.push(æ ‡å‡†åŒ–å€¼);
        }
        return æ ‡å‡†åŒ–ç»“æœ;
    }

    è·å–é£é™©ç­‰çº§(æ¦‚ç‡) {
        if (æ¦‚ç‡ < 0.3) {
            return { 
                ç­‰çº§: 'ä½é£é™©', 
                æ ·å¼: 'é£é™©-ä½',
                æè¿°: 'æ‚£è€…CRFé£é™©è¾ƒä½ï¼Œå»ºè®®å¸¸è§„ç›‘æµ‹'
            };
        }
        if (æ¦‚ç‡ < 0.7) {
            return { 
                ç­‰çº§: 'ä¸­é£é™©', 
                æ ·å¼: 'é£é™©-ä¸­',
                æè¿°: 'æ‚£è€…å­˜åœ¨ä¸­ç­‰CRFé£é™©ï¼Œå»ºè®®åŠ å¼ºè§‚å¯Ÿ'
            };
        }
        return { 
            ç­‰çº§: 'é«˜é£é™©', 
            æ ·å¼: 'é£é™©-é«˜',
            æè¿°: 'æ‚£è€…CRFé£é™©è¾ƒé«˜ï¼Œéœ€è¦ç§¯æå¹²é¢„'
        };
    }

    ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®(æ¦‚ç‡, ç‰¹å¾æ•°æ®) {
        let å»ºè®®åˆ—è¡¨ = [];
        
        // åŸºäºæ€»ä½“é£é™©çš„å»ºè®®
        if (æ¦‚ç‡ > 0.7) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'ç´§æ€¥',
                å†…å®¹: 'ğŸš¨ CRFé«˜é£é™©ï¼šå»ºè®®ç«‹å³è¿›è¡Œç»¼åˆè¯„ä¼°å¹¶åˆ¶å®šå¹²é¢„è®¡åˆ’'
            });
        } else if (æ¦‚ç‡ > 0.5) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'è­¦å‘Š',
                å†…å®¹: 'âš ï¸ ä¸­åº¦CRFé£é™©ï¼šå»ºè®®åŠ å¼ºç—‡çŠ¶ç›‘æµ‹å’Œé¢„é˜²æ€§å¹²é¢„'
            });
        }

        // åŸºäºå…·ä½“ä¸´åºŠç‰¹å¾çš„å»ºè®®
        if (ç‰¹å¾æ•°æ®.ç¡çœ éšœç¢ === 1) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'ç¡çœ ',
                å†…å®¹: 'ğŸ’¤ ç¡çœ éšœç¢ç®¡ç†ï¼š\nâ€¢ å»ºç«‹è§„å¾‹ä½œæ¯æ—¶é—´\nâ€¢ ç¡å‰é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡\nâ€¢ åˆ›é€ å®‰é™ã€èˆ’é€‚çš„ç¡çœ ç¯å¢ƒ\nâ€¢ å¯è€ƒè™‘è®¤çŸ¥è¡Œä¸ºç–—æ³•'
            });
        }

        if (ç‰¹å¾æ•°æ®.ç„¦è™‘ç¨‹åº¦ >= 3) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'å¿ƒç†',
                å†…å®¹: 'ğŸ§˜ ç„¦è™‘æƒ…ç»ªå¹²é¢„ï¼š\nâ€¢ è¿›è¡Œæ”¾æ¾è®­ç»ƒå’Œæ·±å‘¼å¸ç»ƒä¹ \nâ€¢ æä¾›å¿ƒç†æ”¯æŒå’Œå’¨è¯¢\nâ€¢ é¼“åŠ±å‚åŠ æ”¯æŒå°ç»„æ´»åŠ¨\nâ€¢ å¿…è¦æ—¶è½¬è¯Šå¿ƒç†ç§‘'
            });
        }

        if (ç‰¹å¾æ•°æ®.ç„¦è™‘ç¨‹åº¦ === 4) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'å¿ƒç†',
                å†…å®¹: 'ğŸ”´ é‡åº¦ç„¦è™‘ï¼šå»ºè®®ç«‹å³è¿›è¡Œå¿ƒç†è¯„ä¼°å’Œè¯ç‰©æ²»ç–—è¯„ä¼°'
            });
        }

        if (ç‰¹å¾æ•°æ®.è¥å…»é£é™© === 1) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'è¥å…»',
                å†…å®¹: 'ğŸ è¥å…»æ”¯æŒï¼š\nâ€¢ å’¨è¯¢ä¸´åºŠè¥å…»å¸ˆåˆ¶å®šä¸ªä½“åŒ–è†³é£Ÿæ–¹æ¡ˆ\nâ€¢ å¢åŠ ä¼˜è´¨è›‹ç™½è´¨æ‘„å…¥\nâ€¢ å°‘é£Ÿå¤šé¤ï¼Œä¿è¯å……è¶³çƒ­é‡\nâ€¢ ç›‘æµ‹ä½“é‡å˜åŒ–'
            });
        }

        if (ç‰¹å¾æ•°æ®.è¡€æ¸…ç™½è›‹ç™½ < 35) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'è¥å…»',
                å†…å®¹: 'ğŸ¥› ä½è›‹ç™½è¡€ç—‡å¹²é¢„ï¼š\nâ€¢ ä¼˜å…ˆå¢åŠ ä¼˜è´¨è›‹ç™½æ‘„å…¥ï¼ˆé±¼ã€è›‹ã€å¥¶ã€è±†åˆ¶å“ï¼‰\nâ€¢ è€ƒè™‘è¥å…»è¡¥å……å‰‚\nâ€¢ ç›‘æµ‹è¡€æ¸…ç™½è›‹ç™½æ°´å¹³å˜åŒ–'
            });
        }

        if (ç‰¹å¾æ•°æ®.è¡€æ¸…ç™½è›‹ç™½ < 30) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'è¥å…»',
                å†…å®¹: 'ğŸ”´ ä¸¥é‡ä½è›‹ç™½è¡€ç—‡ï¼šå»ºè®®é™è„‰è¥å…»æ”¯æŒå¹¶å¯†åˆ‡ç›‘æµ‹'
            });
        }

        if (ç‰¹å¾æ•°æ®.è‚¿ç˜¤åˆ†æœŸ >= 3) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'è‚¿ç˜¤',
                å†…å®¹: 'ğŸ—ï¸ æ™šæœŸè‚¿ç˜¤æ”¯æŒï¼š\nâ€¢ åŠ å¼ºç—‡çŠ¶æ§åˆ¶å’Œç®¡ç†\nâ€¢ æä¾›å§‘æ¯æ²»ç–—æ”¯æŒ\nâ€¢ å…³æ³¨ç”Ÿæ´»è´¨é‡æ”¹å–„\nâ€¢ å®šæœŸè¯„ä¼°æ²»ç–—è€å—æ€§'
            });
        }

        if (ç‰¹å¾æ•°æ®.è‚¿ç˜¤åˆ†æœŸ === 4) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'è‚¿ç˜¤',
                å†…å®¹: 'ğŸ”´ IVæœŸè‚¿ç˜¤ï¼šå»ºè®®å¤šå­¦ç§‘å›¢é˜Ÿç»¼åˆç®¡ç†ï¼Œé‡ç‚¹å…³æ³¨ç”Ÿæ´»è´¨é‡'
            });
        }

        // å¦‚æœæ²¡æœ‰ç‰¹å®šé£é™©å› ç´ ï¼Œæä¾›ä¸€èˆ¬æ€§å»ºè®®
        if (å»ºè®®åˆ—è¡¨.length === 0) {
            å»ºè®®åˆ—è¡¨.push({
                ç±»å‹: 'ä¸€èˆ¬',
                å†…å®¹: 'âœ… å½“å‰é£é™©å› ç´ æ§åˆ¶è‰¯å¥½ï¼š\nâ€¢ ç»§ç»­ä¿æŒå¥åº·ç”Ÿæ´»æ–¹å¼\nâ€¢ å®šæœŸè¿›è¡ŒCRFç­›æŸ¥\nâ€¢ ç»´æŒç°æœ‰æŠ¤ç†æ–¹æ¡ˆ\nâ€¢ å¦‚æœ‰æ–°ç—‡çŠ¶åŠæ—¶å°±åŒ»'
            });
        }

        return å»ºè®®åˆ—è¡¨;
    }
}

// åˆå§‹åŒ–é¢„æµ‹å™¨å®ä¾‹
const é¢„æµ‹å™¨ = new CRFé¢„æµ‹å™¨();

// ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åæ‰§è¡Œ
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–é¢„æµ‹å·¥å…·');
    
    // è·å–è¡¨å•å…ƒç´ 
    const é¢„æµ‹è¡¨å• = document.getElementById('é¢„æµ‹è¡¨å•');
    const é£é™©ç»“æœå…ƒç´  = document.getElementById('é£é™©ç»“æœ');
    const é£é™©æ¦‚ç‡å…ƒç´  = document.getElementById('é£é™©æ¦‚ç‡');
    const å»ºè®®å†…å®¹å…ƒç´  = document.getElementById('å»ºè®®å†…å®¹');

    // è¡¨å•æäº¤äº‹ä»¶å¤„ç†
    é¢„æµ‹è¡¨å•.addEventListener('submit', function(äº‹ä»¶) {
        äº‹ä»¶.preventDefault();
        
        console.log('ğŸ”„ å¼€å§‹é£é™©é¢„æµ‹è®¡ç®—...');
        
        // æ£€æŸ¥æ¨¡å‹æ˜¯å¦å·²åŠ è½½
        if (!é¢„æµ‹å™¨.æ¨¡å‹å‚æ•°) {
            alert('â³ é¢„æµ‹æ¨¡å‹æ­£åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨ç­‰å‡ ç§’é’Ÿåé‡è¯•');
            return;
        }

        // æ”¶é›†å¹¶éªŒè¯è¡¨å•æ•°æ®
        const ç‰¹å¾æ•°æ® = æ”¶é›†è¡¨å•æ•°æ®();
        if (!ç‰¹å¾æ•°æ®) {
            return; // éªŒè¯å¤±è´¥
        }

        try {
            // æ‰§è¡Œé¢„æµ‹è®¡ç®—
            const æ¦‚ç‡ = é¢„æµ‹å™¨.é¢„æµ‹(ç‰¹å¾æ•°æ®.ç‰¹å¾æ•°ç»„);
            const é£é™©ä¿¡æ¯ = é¢„æµ‹å™¨.è·å–é£é™©ç­‰çº§(æ¦‚ç‡);
            const å»ºè®®åˆ—è¡¨ = é¢„æµ‹å™¨.ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®(æ¦‚ç‡, ç‰¹å¾æ•°æ®.ç‰¹å¾å¯¹è±¡);

            // æ˜¾ç¤ºé¢„æµ‹ç»“æœ
            æ˜¾ç¤ºé¢„æµ‹ç»“æœ(æ¦‚ç‡, é£é™©ä¿¡æ¯, å»ºè®®åˆ—è¡¨);
            
            console.log('âœ… é¢„æµ‹å®Œæˆï¼Œé£é™©æ¦‚ç‡:', (æ¦‚ç‡ * 100).toFixed(1) + '%');

        } catch (é”™è¯¯) {
            console.error('âŒ é¢„æµ‹è¿‡ç¨‹ä¸­å‡ºé”™:', é”™è¯¯);
            alert('é¢„æµ‹è®¡ç®—å¤±è´¥: ' + é”™è¯¯.message);
        }
    });

    // æ”¶é›†è¡¨å•æ•°æ®çš„å‡½æ•°
    function æ”¶é›†è¡¨å•æ•°æ®() {
        const ç‰¹å¾å¯¹è±¡ = {
            ç¡çœ éšœç¢: parseInt(document.getElementById('ç¡çœ éšœç¢').value),
            ç„¦è™‘ç¨‹åº¦: parseInt(document.getElementById('ç„¦è™‘ç¨‹åº¦').value),
            è‚¿ç˜¤åˆ†æœŸ: parseInt(document.getElementById('è‚¿ç˜¤åˆ†æœŸ').value),
            è¥å…»é£é™©: parseInt(document.getElementById('è¥å…»é£é™©').value),
            è¡€æ¸…ç™½è›‹ç™½: parseFloat(document.getElementById('è¡€æ¸…ç™½è›‹ç™½').value),
            å¹´é¾„: parseInt(document.getElementById('å¹´é¾„').value)
        };

        // éªŒè¯å¿…å¡«å­—æ®µ
        for (const [å­—æ®µ, å€¼] of Object.entries(ç‰¹å¾å¯¹è±¡)) {
            if (å€¼ === null || isNaN(å€¼)) {
                alert(`è¯·å¡«å†™å®Œæ•´çš„${å­—æ®µ}ä¿¡æ¯`);
                document.getElementById(å­—æ®µ).focus();
                return null;
            }
        }

        // éªŒè¯æ•°å€¼èŒƒå›´
        if (ç‰¹å¾å¯¹è±¡.è¡€æ¸…ç™½è›‹ç™½ < 20 || ç‰¹å¾å¯¹è±¡.è¡€æ¸…ç™½è›‹ç™½ > 60) {
            alert('è¡€æ¸…ç™½è›‹ç™½å€¼åº”åœ¨20-60 g/LèŒƒå›´å†…');
            document.getElementById('è¡€æ¸…ç™½è›‹ç™½').focus();
            return null;
        }

        if (ç‰¹å¾å¯¹è±¡.å¹´é¾„ < 18 || ç‰¹å¾å¯¹è±¡.å¹´é¾„ > 100) {
            alert('å¹´é¾„åº”åœ¨18-100å²èŒƒå›´å†…');
            document.getElementById('å¹´é¾„').focus();
            return null;
        }

        // è½¬æ¢ä¸ºæ¨¡å‹éœ€è¦çš„ç‰¹å¾æ•°ç»„ï¼ˆæŒ‰è®­ç»ƒæ—¶çš„é¡ºåºï¼‰
        const ç‰¹å¾æ•°ç»„ = [
            ç‰¹å¾å¯¹è±¡.ç¡çœ éšœç¢,
            ç‰¹å¾å¯¹è±¡.ç„¦è™‘ç¨‹åº¦,
            ç‰¹å¾å¯¹è±¡.è‚¿ç˜¤åˆ†æœŸ,
            ç‰¹å¾å¯¹è±¡.è¥å…»é£é™©,
            ç‰¹å¾å¯¹è±¡.è¡€æ¸…ç™½è›‹ç™½,
            ç‰¹å¾å¯¹è±¡.å¹´é¾„,
            1,  // ç–¼ç—› - æ¼”ç¤ºç”¨é»˜è®¤å€¼ï¼ˆæœ‰ç–¼ç—›ï¼‰
            2,  // ç¤¾ä¼šæ”¯æŒ - æ¼”ç¤ºç”¨é»˜è®¤å€¼ï¼ˆä¸­ç­‰æ”¯æŒï¼‰
            2,  // BMIåˆ†ç±» - æ¼”ç¤ºç”¨é»˜è®¤å€¼ï¼ˆæ­£å¸¸ï¼‰
            2,  // æ”¾ç–—æ¬¡æ•° - æ¼”ç¤ºç”¨é»˜è®¤å€¼ï¼ˆ11-20æ¬¡ï¼‰
            2,  // åˆå¹¶ç—‡æŒ‡æ•° - æ¼”ç¤ºç”¨é»˜è®¤å€¼ï¼ˆä¸­ç­‰ï¼‰
            1,  // æ€§åˆ« - æ¼”ç¤ºç”¨é»˜è®¤å€¼ï¼ˆç”·æ€§ï¼‰
            2,  // å©šå§»çŠ¶å†µ - æ¼”ç¤ºç”¨é»˜è®¤å€¼ï¼ˆå·²å©šï¼‰
            3   // æ•™è‚²ç¨‹åº¦ - æ¼”ç¤ºç”¨é»˜è®¤å€¼ï¼ˆé«˜ä¸­æˆ–ä¸­ä¸“ï¼‰
        ];

        return {
            ç‰¹å¾å¯¹è±¡: ç‰¹å¾å¯¹è±¡,
            ç‰¹å¾æ•°ç»„: ç‰¹å¾æ•°ç»„
        };
    }

    // æ˜¾ç¤ºé¢„æµ‹ç»“æœçš„å‡½æ•°
    function æ˜¾ç¤ºé¢„æµ‹ç»“æœ(æ¦‚ç‡, é£é™©ä¿¡æ¯, å»ºè®®åˆ—è¡¨) {
        // æ›´æ–°é£é™©ç­‰çº§æ˜¾ç¤º
        é£é™©ç»“æœå…ƒç´ .textContent = é£é™©ä¿¡æ¯.ç­‰çº§;
        é£é™©ç»“æœå…ƒç´ .className = `display-4 ${é£é™©ä¿¡æ¯.æ ·å¼}`;
        
        // æ›´æ–°æ¦‚ç‡æ˜¾ç¤º
        const æ¦‚ç‡ç™¾åˆ†æ¯” = (æ¦‚ç‡ * 100).toFixed(1);
        é£é™©æ¦‚ç‡å…ƒç´ .textContent = `é¢„æµ‹æ¦‚ç‡: ${æ¦‚ç‡ç™¾åˆ†æ¯”}%`;
        é£é™©æ¦‚ç‡å…ƒç´ .innerHTML = `é¢„æµ‹æ¦‚ç‡: <strong>${æ¦‚ç‡ç™¾åˆ†æ¯”}%</strong>`;

        // æ˜¾ç¤ºä¸ªæ€§åŒ–å»ºè®®
        æ˜¾ç¤ºä¸ªæ€§åŒ–å»ºè®®(å»ºè®®åˆ—è¡¨);
    }

    // æ˜¾ç¤ºä¸ªæ€§åŒ–å»ºè®®çš„å‡½æ•°
    function æ˜¾ç¤ºä¸ªæ€§åŒ–å»ºè®®(å»ºè®®åˆ—è¡¨) {
        let å»ºè®®HTML = '';
        
        å»ºè®®åˆ—è¡¨.forEach((å»ºè®®, ç´¢å¼•) => {
            // ä¸ºä¸åŒç±»å‹çš„å»ºè®®æ·»åŠ ä¸åŒçš„å›¾æ ‡å’Œæ ·å¼
            let å›¾æ ‡ = 'ğŸ’¡';
            let æ ·å¼ç±» = 'å»ºè®®-ä¸€èˆ¬';
            
            switch (å»ºè®®.ç±»å‹) {
                case 'ç´§æ€¥':
                    å›¾æ ‡ = 'ğŸš¨';
                    æ ·å¼ç±» = 'å»ºè®®-ç´§æ€¥';
                    break;
                case 'è­¦å‘Š':
                    å›¾æ ‡ = 'âš ï¸';
                    æ ·å¼ç±» = 'å»ºè®®-è­¦å‘Š';
                    break;
                case 'ç¡çœ ':
                    å›¾æ ‡ = 'ğŸ’¤';
                    æ ·å¼ç±» = 'å»ºè®®-ç¡çœ ';
                    break;
                case 'å¿ƒç†':
                    å›¾æ ‡ = 'ğŸ§˜';
                    æ ·å¼ç±» = 'å»ºè®®-å¿ƒç†';
                    break;
                case 'è¥å…»':
                    å›¾æ ‡ = 'ğŸ';
                    æ ·å¼ç±» = 'å»ºè®®-è¥å…»';
                    break;
                case 'è‚¿ç˜¤':
                    å›¾æ ‡ = 'ğŸ—ï¸';
                    æ ·å¼ç±» = 'å»ºè®®-è‚¿ç˜¤';
                    break;
            }
            
            å»ºè®®HTML += `
                <div class="å»ºè®®é¡¹ ${æ ·å¼ç±»}">
                    <div class="å»ºè®®æ ‡é¢˜">
                        ${å›¾æ ‡} ${å»ºè®®.ç±»å‹}å»ºè®®
                    </div>
                    <div class="å»ºè®®å†…å®¹">
                        ${å»ºè®®.å†…å®¹.replace(/\n/g, '<br>')}
                    </div>
                </div>
            `;
        });

        å»ºè®®å†…å®¹å…ƒç´ .innerHTML = å»ºè®®HTML;
    }

    // æ·»åŠ è¾“å…¥éªŒè¯çš„å®æ—¶åé¦ˆ
    æ·»åŠ è¾“å…¥éªŒè¯();
});

// æ·»åŠ è¾“å…¥éªŒè¯å‡½æ•°
function æ·»åŠ è¾“å…¥éªŒè¯() {
    // è¡€æ¸…ç™½è›‹ç™½éªŒè¯
    const è¡€æ¸…ç™½è›‹ç™½è¾“å…¥ = document.getElementById('è¡€æ¸…ç™½è›‹ç™½');
    è¡€æ¸…ç™½è›‹ç™½è¾“å…¥.addEventListener('blur', function() {
        const å€¼ = parseFloat(this.value);
        const åé¦ˆå…ƒç´  = this.nextElementSibling;
        
        if (!åé¦ˆå…ƒç´  || !åé¦ˆElement.classList.contains('invalid-feedback')) {
            // åˆ›å»ºåé¦ˆå…ƒç´ 
            const æ–°åé¦ˆå…ƒç´  = document.createElement('div');
            æ–°åé¦ˆå…ƒç´ .className = 'invalid-feedback';
            this.parentNode.appendChild(æ–°åé¦ˆå…ƒç´ );
        }
        
        if (å€¼ < 20 || å€¼ > 60 || isNaN(å€¼)) {
            this.classList.add('is-invalid');
            this.nextElementSibling.textContent = 'è¡€æ¸…ç™½è›‹ç™½æ­£å¸¸èŒƒå›´: 20-60 g/L';
        } else {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        }
    });

    // å¹´é¾„éªŒè¯
    const å¹´é¾„è¾“å…¥ = document.getElementById('å¹´é¾„');
    å¹´é¾„è¾“å…¥.addEventListener('blur', function() {
        const å€¼ = parseInt(this.value);
        const åé¦ˆå…ƒç´  = this.nextElementSibling;
        
        if (!åé¦ˆå…ƒç´  || !åé¦ˆå…ƒç´ .classList.contains('invalid-feedback')) {
            const æ–°åé¦ˆå…ƒç´  = document.createElement('div');
            æ–°åé¦ˆå…ƒç´ .className = 'invalid-feedback';
            this.parentNode.appendChild(æ–°åé¦ˆå…ƒç´ );
        }
        
        if (å€¼ < 18 || å€¼ > 100 || isNaN(å€¼)) {
            this.classList.add('is-invalid');
            this.nextElementSibling.textContent = 'å¹´é¾„èŒƒå›´: 18-100å²';
        } else {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        }
    });
}

// æ·»åŠ CSSæ ·å¼ï¼ˆé€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ ï¼‰
const åŠ¨æ€æ ·å¼ = `
    .å»ºè®®é¡¹ {
        border-left: 4px solid #007bff;
        padding: 12px;
        margin-bottom: 10px;
        background: #f8f9fa;
        border-radius: 4px;
    }
    
    .å»ºè®®-ç´§æ€¥ {
        border-left-color: #dc3545;
        background: #fff5f5;
    }
    
    .å»ºè®®-è­¦å‘Š {
        border-left-color: #ffc107;
        background: #fffbf0;
    }
    
    .å»ºè®®-ç¡çœ  {
        border-left-color: #6f42c1;
        background: #f8f9fa;
    }
    
    .å»ºè®®-å¿ƒç† {
        border-left-color: #20c997;
        background: #f0fdf9;
    }
    
    .å»ºè®®-è¥å…» {
        border-left-color: #fd7e14;
        background: #fff4e6;
    }
    
    .å»ºè®®-è‚¿ç˜¤ {
        border-left-color: #e83e8c;
        background: #fce8f1;
    }
    
    .å»ºè®®æ ‡é¢˜ {
        font-weight: bold;
        margin-bottom: 5px;
        color: #495057;
    }
    
    .å»ºè®®å†…å®¹ {
        color: #6c757d;
        line-height: 1.5;
    }
    
    .é£é™©-ä½ {
        color: #28a745;
        font-weight: bold;
    }
    
    .é£é™©-ä¸­ {
        color: #ffc107;
        font-weight: bold;
    }
    
    .é£é™©-é«˜ {
        color: #dc3545;
        font-weight: bold;
    }
`;

// å°†æ ·å¼æ·»åŠ åˆ°é¡µé¢
const æ ·å¼å…ƒç´  = document.createElement('style');
æ ·å¼å…ƒç´ .textContent = åŠ¨æ€æ ·å¼;
document.head.appendChild(æ ·å¼å…ƒç´ );

console.log('ğŸ§© CRFé£é™©é¢„æµ‹å™¨åˆå§‹åŒ–å®Œæˆ');